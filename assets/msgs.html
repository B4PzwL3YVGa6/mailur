<div class="msgs">
  <div class="msgs__header">
    <div v-if="canOpenInSplit()">
      <button @click="openInSplit()">Copy from main</button>
    </div>
    <div v-if="!split" class="msgs__header__search">
      <input v-model.lazy.trim="query" @keyup.enter="fetch()">
      <button @click="fetch()" class="icon--search"></button>
    </div>
    <div v-if="picked.length" class="msgs__header__actions">
      <button class="icon--archive" title="Archive"></button>
      <button class="icon--trash" title="Move to Trash"></button>
      <button
        v-if="threads && picked.length > 1"
        @click="link" class="icon--link"
        title="Link threads together"
      ></button>
    </div>
    <div v-if="pages.length" class="msgs__header__picking">
      <span>
        {{length}} of {{uids.length}} {{threads ? 'threads' : 'emails'}}
      </span>
      <span>
        (Select
        <a v-if="length > picked.length" @click.prevent="pickAll" href="#">All</a>
        <a v-if="picked.length > 0" @click.prevent="pickNone" href="#">None</a>
        )
      </span>
    </div>
  </div>
  <div v-for="uids of pages" class="msgs__body">
    <template v-if="!pages.length">
    <div v-if="query">Loading...</div>
    </template>
    <div
      v-for="msg in page(uids)"
      :key="msg.uid"
      :class="['msg', {'msg--unread': msg.is_unread, 'msg--pinned': msg.is_pinned, 'msg--detailed': detailed == msg.uid}]"
    >
      <div class="msg__line">
        <div class="icon--pin" :title="msg.is_pinned ? 'Unpin' : 'Pin'"></div>
        <div class="icon--unread" :title="`Mark as ${msg.is_unread ? 'read' : 'unread'}`"></div>
        <div v-if="threads" @click.stop="details(msg.uid)" class="icon--more" title="More actions"></div>
        <tags :raw="msg.flags" :trancated="true" />
        <msg-line :msg="msg" :open="open" :fetch="fetch" />
        <div class="msg__line__pick">
          <input :id="msg.uid" :value="msg.uid" v-model="picked" type="checkbox">
        </div>
        <div
          v-if="threads && hasSplit()"
          @click.prevent="openInSplit(msg.query_thread)"
          class="icon--open-in-split"
          title="Open in split pane"
        ></div>
      </div>
      <div class="msg__actions">
        <!-- <a href="#" class="icon-unread">Mark as {{msg.is_unread ? '' : 'un'}}read</a> -->
        <a href="#" class="icon--archive" title="Archive">Archive</a>
        <a href="#" class="icon--reply" title="Reply">Reply</a>
        <a href="#" class="icon--reply-all" title="Reply to all">Reply to all</a>
        <a href="#" class="icon--forward" title="Forward">Forward</a>
        <a href="#" class="icon--trash" title="Move to Trash">Delete</a>
        <a href="#" class="icon--whitelist" title="Add address to Whitelist">Whitelist</a>
        <a href="#" class="icon--blacklist" title="Add address to Blacklist">Blacklist</a>
        <a :href="`#${msg.query_subject}`" @click.stop="fetch(msg.query_subject)" class="icon--ok" >Filter by subject</a>
        <a :href="msg.url_raw" class="icon--ok" target="_blank">Show original</a>
        <!-- <a @click.prevent="fetch(msg.query_msgid)" href="#" :title="msg.msgid">ID</a> -->
      </div>
      <div v-if="msg.body" v-html="msg.body"></div>
    </div>
  </div>
  <a @click.prevent="loadMore()" href="#" v-if="canLoadMore()">Load more...</a>
</div>
