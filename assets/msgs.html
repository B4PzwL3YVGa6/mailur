<div class="msgs">
  <div class="msgs-header">
    <div class="msgs-search">
      <input v-model.lazy.trim="query" @keyup.enter="fetch()">
      <button @click="fetch()" class="icon-search"></button>
    </div>
    <div v-if="picked.length" class="msgs-actions">
      <button class="icon-archive" title="Archive"></button>
      <button class="icon-trash" title="Move to Trash"></button>
      <button v-if="threads && picked.length > 1" @click="link" class="icon-link" title="Link threads together"></button>
    </div>
    <div v-if="pages.length" class="msgs-picking">
    <span>
      {{length}} of {{uids.length}} {{threads ? 'threads' : 'emails'}}
    </span>
    <span>
      (Select
      <a v-if="length > picked.length" @click.prevent="pickAll" href="#">All</a>
      <a v-if="picked.length > 0" @click.prevent="pickNone" href="#">None</a>
      )
    </span>
    </div>
  </div>
  <span v-if="!pages.length">Loading...</span>
  <div v-for="uids of pages">
    <div v-for="msg in page(uids)" :key="msg.uid" :class="['msg', {'msg-is-unread': msg.is_unread, 'msg-is-pinned': msg.is_pinned, 'msg-detailed': detailed == msg.uid}]">
      <div class="msg-line">
        <span class="msg-from">
        <template v-for="from in msg.from_list">
          <span v-if="from.expander" class="msg-from-more" :title="`${from.expander} more`">
            {{from.expander}}
          </span>
          <span v-if="from.hash" @click.stop="searchAddr(from.addr)" :class="`msg-from-pic pic-${from.hash}`" :title="from.title"></span>
        </template>
        </span>
        <tags :raw="msg.flags" :trancate="true" />
        <span @click.prevent="threads ? thread(msg.uid) : details(msg.uid)" class="msg-preview">
          <span class="msg-preview-from" :title="msg.from.title">
            {{ msg.from.name }}
          </span>
          <span class="msg-preview-subj" :title="msg.subject">
             {{ msg.subject }}
          </span>
          <span class="msg-preview-text" :title="msg.preview">
            {{ msg.preview }}
          </span>
        </span>
        <span class="msg-date" :title="msg.time_title">{{ msg.time_human }}</span>
        <span class="msg-unread icon-unread" :title="`Mark as ${msg.is_unread ? 'read' : 'unread'}`"></span>
        <span class="msg-pin icon-pin" :title="msg.is_pinned ? 'Unpin' : 'Pin'"></span>
        <span v-if="threads" @click.stop="details(msg.uid)" class="msg-more icon-details" title="More actions"></span>
        <span class="msg-pick">
          <input :id="msg.uid" :value="msg.uid" v-model="picked" type="checkbox">
        </span>
      </div>
      <div class="msg-actions">
        <!-- <a href="#" class="icon-unread">Mark as {{msg.is_unread ? '' : 'un'}}read</a> -->
        <a href="#" class="icon-archive" title="Archive">Archive</a>
        <a href="#" class="icon-reply" title="Reply">Reply</a>
        <a href="#" class="icon-replyall" title="Reply to all">Reply to all</a>
        <a href="#" class="icon-forward" title="Forward">Forward</a>
        <a href="#" class="icon-trash" title="Move to Trash">Delete</a>
        <a href="#" class="icon-ok" title="Add address to Whitelist">Whitelist</a>
        <a href="#" class="icon-spam" title="Add address to Blacklist">Blacklist</a>
        <a href="#" class="icon-plus" @click.stop="searchHeader('subject', msg.subject)" >Filter by subject</a>
        <a :href="msg.url_raw_origin" class="icon-plus" target="_blank">Show original</a>
        <!-- <a :href="msg.url_raw_origin" target="_blank" :title="`Show raw message ${msg.origin_uid} (origin)`">{{msg.origin_uid}}</a> -->
        <!-- <a @click.prevent="searchHeader('message-id ', msg.msgid)" href="#" :title="msg.msgid">ID</a> -->
      </div>
      <div v-if="msg.body" v-html="msg.body"></div>
    </div>
  </div>
  <a @click.prevent="loadMore()" href="#" v-if="canLoadMore()">Load more...</a>
</div>
