<!DOCTYPE html>
<html>
<head>
  <title>Mailur</title>
  <script src="vue.js"></script>
</head>
<body>
  <div id="app">
    <input v-model.lazy.trim="query" @keyup.enter="get">
    <input type="checkbox" id="show_bodies" v-model="show_bodies">
    <label for="show_bodies">bodies</label>
    <input type="checkbox" id="show_threads" v-model="show_threads">
    <label for="show_threads">treads</label>
    <button v-on:click="get">go!</button>
    <div v-for="uid in uids">
      <a v-bind:href="origin_url(msgs[uid])" target="_blank">{{ uid }}</a>
      <i>{{ flags[uid] }}</i>
      <b>{{ msgs[uid].subject }}</b>
      <span>{{ msgs[uid].date }}</span>
      <span>{{ msgs[uid].message_id }}</span>
      <div v-if="show_bodies" v-html="msgs[uid].body"></div>
    </div>
  </div>

  <script>
  var app = new Vue({
    el: '#app',
    data: {
      uids: [],
      msgs: {},
      flags: {},
      query: 'all',
      show_threads: false,
      show_bodies: false,
    },
    methods: {
      get: function() {
        var base_url = app.show_threads && '/threads?q=' || '/emails?q=';
        fetch(base_url + app.query).then(function(response) {
          return response.json();
        }).then(function(res) {
          app.uids = res.uids;
          app.msgs = res.msgs;
          app.flags = res.flags;
        });
      },
      origin_url: function(item) {
        return '/origin/' + item.uid;
      }
    }
  });
  app.get();
  </script>
</body>
</html>
